"use strict";jcf.addModule(function(l,t){var e={name:"Scrollable",selector:".jcf-scrollable",plugins:{ScrollBar:i},options:{mouseWheelStep:150,handleResize:!0,alwaysShowScrollbars:!1,alwaysPreventMouseWheel:!1,scrollAreaStructure:'<div class="jcf-scrollable-wrapper"></div>'},matchElement:function(t){return t.is(".jcf-scrollable")},init:function(){this.initStructure(),this.attachEvents(),this.rebuildScrollbars()},initStructure:function(){this.doc=l(document),this.win=l(t),this.realElement=l(this.options.element),this.scrollWrapper=l(this.options.scrollAreaStructure).insertAfter(this.realElement),this.scrollWrapper.css("position","relative"),this.realElement.css("overflow","hidden"),this.vBarEdge=0},attachEvents:function(){var e=this;this.vBar=new i({holder:this.scrollWrapper,vertical:!0,onScroll:function(t){e.realElement.scrollTop(t)}}),this.hBar=new i({holder:this.scrollWrapper,vertical:!1,onScroll:function(t){e.realElement.scrollLeft(t)}}),this.realElement.on("scroll",this.onScroll),this.options.handleResize&&this.win.on("resize orientationchange load",this.onResize),this.realElement.on("jcf-mousewheel",this.onMouseWheel),this.realElement.on("jcf-pointerdown",this.onTouchBody)},onScroll:function(){this.redrawScrollbars()},onResize:function(){l(document.activeElement).is(":input")||this.rebuildScrollbars()},onTouchBody:function(t){"touch"===t.pointerType&&(this.touchData={scrollTop:this.realElement.scrollTop(),scrollLeft:this.realElement.scrollLeft(),left:t.pageX,top:t.pageY},this.doc.on({"jcf-pointermove":this.onMoveBody,"jcf-pointerup":this.onReleaseBody}))},onMoveBody:function(t){var e,i,s=this.verticalScrollActive,o=this.horizontalScrollActive;"touch"===t.pointerType&&(e=this.touchData.scrollTop-t.pageY+this.touchData.top,i=this.touchData.scrollLeft-t.pageX+this.touchData.left,this.verticalScrollActive&&(e<0||e>this.vBar.maxValue)&&(s=!1),this.horizontalScrollActive&&(i<0||i>this.hBar.maxValue)&&(o=!1),this.realElement.scrollTop(e),this.realElement.scrollLeft(i),s||o?t.preventDefault():this.onReleaseBody(t))},onReleaseBody:function(t){"touch"===t.pointerType&&(delete this.touchData,this.doc.off({"jcf-pointermove":this.onMoveBody,"jcf-pointerup":this.onReleaseBody}))},onMouseWheel:function(t){var e,i=this.realElement.scrollTop(),s=this.realElement.scrollLeft(),o=this.realElement.prop("scrollHeight")-this.embeddedDimensions.innerHeight,l=this.realElement.prop("scrollWidth")-this.embeddedDimensions.innerWidth;(this.options.alwaysPreventMouseWheel||(this.verticalScrollActive&&t.deltaY&&(i<=0&&t.deltaY<0||o<=i&&0<t.deltaY||(e=!0)),this.horizontalScrollActive&&t.deltaX&&(s<=0&&t.deltaX<0||l<=s&&0<t.deltaX||(e=!0)),this.verticalScrollActive||this.horizontalScrollActive))&&(e||this.options.alwaysPreventMouseWheel)&&(t.preventDefault(),o=t.deltaX/100*this.options.mouseWheelStep,l=t.deltaY/100*this.options.mouseWheelStep,this.realElement.scrollTop(i+l),this.realElement.scrollLeft(s+o))},setScrollBarEdge:function(t){this.vBarEdge=t||0,this.redrawScrollbars()},saveElementDimensions:function(){return this.savedDimensions={top:this.realElement.width(),left:this.realElement.height()},this},restoreElementDimensions:function(){return this.savedDimensions&&this.realElement.css({width:this.savedDimensions.width,height:this.savedDimensions.height}),this},saveScrollOffsets:function(){return this.savedOffsets={top:this.realElement.scrollTop(),left:this.realElement.scrollLeft()},this},restoreScrollOffsets:function(){return this.savedOffsets&&(this.realElement.scrollTop(this.savedOffsets.top),this.realElement.scrollLeft(this.savedOffsets.left)),this},getContainerDimensions:function(){var t,e,i;return this.isModifiedStyles?t={width:this.realElement.innerWidth()+this.vBar.getThickness(),height:this.realElement.innerHeight()+this.hBar.getThickness()}:(this.saveElementDimensions().saveScrollOffsets(),this.realElement.insertAfter(this.scrollWrapper),this.scrollWrapper.detach(),e=this.realElement.prop("style"),i=parseFloat(e.width),e=parseFloat(e.height),this.embeddedDimensions&&i&&e&&(this.isModifiedStyles|=i!==this.embeddedDimensions.width||e!==this.embeddedDimensions.height,this.realElement.css({overflow:"",width:"",height:""})),t={width:this.realElement.outerWidth(),height:this.realElement.outerHeight()},this.scrollWrapper.insertAfter(this.realElement),this.realElement.css("overflow","hidden").prependTo(this.scrollWrapper),this.restoreElementDimensions().restoreScrollOffsets()),t},getEmbeddedDimensions:function(t){var e=this.vBar.getThickness(),i=this.hBar.getThickness(),s=this.realElement.outerWidth()-this.realElement.width(),o=this.realElement.outerHeight()-this.realElement.height(),e=this.options.alwaysShowScrollbars?(this.verticalScrollActive=!0,this.horizontalScrollActive=!0,{innerWidth:t.width-e,innerHeight:t.height-i}):(this.saveElementDimensions(),this.verticalScrollActive=!1,this.horizontalScrollActive=!1,this.realElement.css({width:t.width-s,height:t.height-o}),this.horizontalScrollActive=this.realElement.prop("scrollWidth")>this.containerDimensions.width,this.verticalScrollActive=this.realElement.prop("scrollHeight")>this.containerDimensions.height,this.restoreElementDimensions(),{innerWidth:t.width-(this.verticalScrollActive?e:0),innerHeight:t.height-(this.horizontalScrollActive?i:0)});return l.extend(e,{width:e.innerWidth-s,height:e.innerHeight-o}),e},rebuildScrollbars:function(){this.containerDimensions=this.getContainerDimensions(),this.embeddedDimensions=this.getEmbeddedDimensions(this.containerDimensions),this.scrollWrapper.css({width:this.containerDimensions.width,height:this.containerDimensions.height}),this.realElement.css({overflow:"hidden",width:this.embeddedDimensions.width,height:this.embeddedDimensions.height}),this.redrawScrollbars()},redrawScrollbars:function(){this.verticalScrollActive?(t=this.vBarEdge?this.containerDimensions.height-this.vBarEdge:this.embeddedDimensions.innerHeight,e=Math.max(this.realElement.prop("offsetHeight"),this.realElement.prop("scrollHeight"))-this.vBarEdge,this.vBar.show().setMaxValue(e-t).setRatio(t/e).setSize(t),this.vBar.setValue(this.realElement.scrollTop())):this.vBar.hide(),this.horizontalScrollActive?(t=this.embeddedDimensions.innerWidth,(e=this.realElement.prop("scrollWidth"))===t&&(this.horizontalScrollActive=!1),this.hBar.show().setMaxValue(e-t).setRatio(t/e).setSize(t),this.hBar.setValue(this.realElement.scrollLeft())):this.hBar.hide();var t,e="";this.verticalScrollActive&&this.horizontalScrollActive?e="none":this.verticalScrollActive?e="pan-x":this.horizontalScrollActive&&(e="pan-y"),this.realElement.css("touchAction",e)},refresh:function(){this.rebuildScrollbars()},destroy:function(){this.win.off("resize orientationchange load",this.onResize),this.realElement.off({"jcf-mousewheel":this.onMouseWheel,"jcf-pointerdown":this.onTouchBody}),this.doc.off({"jcf-pointermove":this.onMoveBody,"jcf-pointerup":this.onReleaseBody}),this.saveScrollOffsets(),this.vBar.destroy(),this.hBar.destroy(),this.realElement.insertAfter(this.scrollWrapper).css({touchAction:"",overflow:"",width:"",height:""}),this.scrollWrapper.remove(),this.restoreScrollOffsets()}};function i(t){this.options=l.extend({holder:null,vertical:!0,inactiveClass:"jcf-inactive",verticalClass:"jcf-scrollbar-vertical",horizontalClass:"jcf-scrollbar-horizontal",scrollbarStructure:'<div class="jcf-scrollbar"><div class="jcf-scrollbar-dec"></div><div class="jcf-scrollbar-slider"><div class="jcf-scrollbar-handle"></div></div><div class="jcf-scrollbar-inc"></div></div>',btnDecSelector:".jcf-scrollbar-dec",btnIncSelector:".jcf-scrollbar-inc",sliderSelector:".jcf-scrollbar-slider",handleSelector:".jcf-scrollbar-handle",scrollInterval:300,scrollStep:400},t),this.init()}return l.extend(i.prototype,{init:function(){this.initStructure(),this.attachEvents()},initStructure:function(){this.doc=l(document),this.isVertical=!!this.options.vertical,this.sizeProperty=this.isVertical?"height":"width",this.fullSizeProperty=this.isVertical?"outerHeight":"outerWidth",this.invertedSizeProperty=this.isVertical?"width":"height",this.thicknessMeasureMethod="outer"+this.invertedSizeProperty.charAt(0).toUpperCase()+this.invertedSizeProperty.substr(1),this.offsetProperty=this.isVertical?"top":"left",this.offsetEventProperty=this.isVertical?"pageY":"pageX",this.value=this.options.value||0,this.maxValue=this.options.maxValue||0,this.currentSliderSize=0,this.handleSize=0,this.holder=l(this.options.holder),this.scrollbar=l(this.options.scrollbarStructure).appendTo(this.holder),this.btnDec=this.scrollbar.find(this.options.btnDecSelector),this.btnInc=this.scrollbar.find(this.options.btnIncSelector),this.slider=this.scrollbar.find(this.options.sliderSelector),this.handle=this.slider.find(this.options.handleSelector),this.scrollbar.addClass(this.isVertical?this.options.verticalClass:this.options.horizontalClass).css({touchAction:this.isVertical?"pan-x":"pan-y",position:"absolute"}),this.slider.css({position:"relative"}),this.handle.css({touchAction:"none",position:"absolute"})},attachEvents:function(){this.bindHandlers(),this.handle.on("jcf-pointerdown",this.onHandlePress),this.slider.add(this.btnDec).add(this.btnInc).on("jcf-pointerdown",this.onButtonPress)},onHandlePress:function(t){"mouse"===t.pointerType&&1<t.button||(t.preventDefault(),this.handleDragActive=!0,this.sliderOffset=this.slider.offset()[this.offsetProperty],this.innerHandleOffset=t[this.offsetEventProperty]-this.handle.offset()[this.offsetProperty],this.doc.on("jcf-pointermove",this.onHandleDrag),this.doc.on("jcf-pointerup",this.onHandleRelease))},onHandleDrag:function(t){t.preventDefault(),this.calcOffset=t[this.offsetEventProperty]-this.sliderOffset-this.innerHandleOffset,this.setValue(this.calcOffset/(this.currentSliderSize-this.handleSize)*this.maxValue),this.triggerScrollEvent(this.value)},onHandleRelease:function(){this.handleDragActive=!1,this.doc.off("jcf-pointermove",this.onHandleDrag),this.doc.off("jcf-pointerup",this.onHandleRelease)},onButtonPress:function(t){var e,i;"mouse"===t.pointerType&&1<t.button||(t.preventDefault(),this.handleDragActive||(this.slider.is(t.currentTarget)?(e=this.handle.offset()[this.offsetProperty]>t[this.offsetEventProperty]?-1:1,i=t[this.offsetEventProperty]-this.slider.offset()[this.offsetProperty],this.startPageScrolling(e,i)):(e=this.btnDec.is(t.currentTarget)?-1:1,this.startSmoothScrolling(e)),this.doc.on("jcf-pointerup",this.onButtonRelease)))},onButtonRelease:function(){this.stopPageScrolling(),this.stopSmoothScrolling(),this.doc.off("jcf-pointerup",this.onButtonRelease)},startPageScrolling:function(e,i){function t(){var t;s.value+=o,s.setValue(s.value),s.triggerScrollEvent(s.value),t=s.value/s.maxValue*(s.currentSliderSize-s.handleSize),(0<e?t+s.handleSize>=i:t<=i)&&clearInterval(s.pageScrollTimer)}var s=this,o=e*s.currentSize;this.pageScrollTimer=setInterval(t,this.options.scrollInterval),t()},stopPageScrolling:function(){clearInterval(this.pageScrollTimer)},startSmoothScrolling:function(e){function i(){var t=(r()-s)/1e3*o.options.scrollStep;o.smoothScrollActive&&(o.value+=t*e,o.setValue(o.value),o.triggerScrollEvent(o.value),n()||(s=r(),l(i)))}var s,o=this,l=(this.stopSmoothScrolling(),t.requestAnimationFrame||function(t){setTimeout(t,16)}),r=function(){return Date.now?Date.now():(new Date).getTime()},n=function(){return 0<e?o.value>=o.maxValue:o.value<=0};o.smoothScrollActive=!0,s=r(),l(i)},stopSmoothScrolling:function(){this.smoothScrollActive=!1},triggerScrollEvent:function(t){this.options.onScroll&&this.options.onScroll(t)},getThickness:function(){return this.scrollbar[this.thicknessMeasureMethod]()},setSize:function(t){var e=this.btnDec[this.fullSizeProperty](),i=this.btnInc[this.fullSizeProperty]();return this.currentSize=t,this.currentSliderSize=t-e-i,this.scrollbar.css(this.sizeProperty,t),this.slider.css(this.sizeProperty,this.currentSliderSize),this.currentSliderSize=this.slider[this.sizeProperty](),this.handleSize=Math.round(this.currentSliderSize*this.ratio),this.handle.css(this.sizeProperty,this.handleSize),this.handleSize=this.handle[this.fullSizeProperty](),this},setRatio:function(t){return this.ratio=t,this},setMaxValue:function(t){return this.maxValue=t,this.setValue(Math.min(this.value,this.maxValue)),this},setValue:function(t){this.value=t,this.value<0?this.value=0:this.value>this.maxValue&&(this.value=this.maxValue),this.refresh()},setPosition:function(t){return this.scrollbar.css(t),this},hide:function(){return this.scrollbar.detach(),this},show:function(){return this.scrollbar.appendTo(this.holder),this},refresh:function(){0===this.value||0===this.maxValue?this.calcOffset=0:this.calcOffset=this.value/this.maxValue*(this.currentSliderSize-this.handleSize),this.handle.css(this.offsetProperty,this.calcOffset),this.btnDec.toggleClass(this.options.inactiveClass,0===this.value),this.btnInc.toggleClass(this.options.inactiveClass,this.value===this.maxValue),this.scrollbar.toggleClass(this.options.inactiveClass,0===this.maxValue)},destroy:function(){this.btnDec.add(this.btnInc).off("jcf-pointerdown",this.onButtonPress),this.handle.off("jcf-pointerdown",this.onHandlePress),this.doc.off("jcf-pointermove",this.onHandleDrag),this.doc.off("jcf-pointerup",this.onHandleRelease),this.doc.off("jcf-pointerup",this.onButtonRelease),this.stopSmoothScrolling(),this.stopPageScrolling(),this.scrollbar.remove()}}),e});